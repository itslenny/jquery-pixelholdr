(function($){$.fn.extend({options:{flickrKey:null,flickrBaseURL:'http://api.flickr.com/services/rest/',flickrSafeSearch:1},pixelholdr:function(a){if(!a.flickrKey){alert('Missing Flickr API key.')}var b=this;$.extend(b.options,a);return this.each(function(){var o=a;b.initializeItem(this)})},initializeItem:function(c){var d=this;var e=$(c).html();$(c).css({'overflow':'hidden'});$.getJSON(d._getFlickrSearchURL(e),function(b){if(!b.photos)return;photo=b.photos.photo[Math.floor(Math.random()*b.photos.photo.length)];if(photo&&photo.id){$.getJSON(d._getFlickrImageURL(photo.id),function(a){$(c).html('');$('<img>').attr({'src':d._getProperImageSource(a,c),'alt':e}).appendTo(c).load(function(){console.log('obj (div): '+$(c).width()+'x'+$(c).height());console.log('this (img): '+$(this).width()+'x'+$(this).height());console.log((($(c).height()*$(this).width())/$(c).height())+' > '+$(c).width());if(($(this).height()*$(c).width())/$(this).width()>$(c).height()){$(this).css('width',$(c).width()+'px')}if(($(this).width()*$(c).height())/$(this).height()>$(c).width()){$(this).css('height',$(c).height()+'px')}if($(this).width()>$(c).width()){$(this).css('margin-left','-'+(($(this).width()-$(c).width())/2)+'px')}if($(this).height()>$(c).height()){$(this).css('margin-top','-'+(($(this).height()-$(c).height())/2)+'px')}})})}})},_getFlickrSearchURL:function(a){return this.options.flickrBaseURL+'?method=flickr.photos.search&api_key='+this.options.flickrKey+'&tags='+a+'&safe_search='+this.options.flickrSafeSearch+'&content_type=1&format=json&jsoncallback=?'},_getFlickrImageURL:function(a){return this.options.flickrBaseURL+'?method=flickr.photos.getSizes&api_key='+this.options.flickrKey+'&photo_id='+a+'&format=json&jsoncallback=?'},_getProperImageSource:function(a,b){var c=$(b).width();var d=$(b).height();for(var i in a.sizes.size){var e=parseInt(a.sizes.size[i].width);var f=parseInt(a.sizes.size[i].height);if(e>c&&f>d){return a.sizes.size[i].source}}return a.sizes.size.pop().source}})})(jQuery);